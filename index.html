<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Speech Transcription & Translation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Ladda CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Ladda/1.0.6/ladda-themeless.min.css" />

  <!-- Spin.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js"></script>
  <!-- Ladda JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Ladda/1.0.6/ladda.min.js"></script>

  <style>
    .card {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .loading {
      display: none;
    }

    #audioPlayer {
      width: 100%;
    }

    .alert {
      display: none;
      margin-top: 1rem;
    }

    .input-method {
      display: none;
    }

    .input-method.active {
      display: block;
    }

    .record-button {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background-color: #dc3545;
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .record-button:hover {
      transform: scale(1.1);
    }

    .record-button.recording {
      animation: pulse 1.5s infinite;
    }

    .audio-visualizer {
      height: 60px;
      background: #f8f9fa;
      margin: 10px 0;
      border-radius: 5px;
      display: none;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
      }

      70% {
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
      }

      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
      }
    }
  </style>
</head>

<body
  style="background-image: url('/static/images/vecteezy_minimal-background-purple-color-with-two-overlapping-waves_12847554.jpg'); background-size: cover; background-position: center;">
  <nav class="navbar" style="background: linear-gradient(90deg, #6b11cb85, #5715c0); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
    <div class="container d-flex justify-content-center align-items-center">
      <a class="navbar-brand d-flex align-items-center" href="#"></a>
        <img src="/static/images/PngItem_5271717.png" alt="Logo" style="height: 40px; filter: invert(1);" />
        <span class="ms-2 text-white" style="font-weight: 600; font-size: 1.2rem;">Audio Recognition Model</span>
      </a>
    </div>
  </nav>
  <div class="section">
    <div class="container">
      <!-- Error Alert -->
      <div id="errorAlert" class="alert alert-danger" role="alert">
        <strong>Error:</strong> <span id="errorMessage"></span>
      </div>
      <!-- Success Alert -->
      <div id="successAlert" class="alert alert-success" role="alert">
        <strong>Success!</strong> <span id="successMessage"></span>
      </div>
      
      <div class="container mt-5" style="position:relative;">
        <div class="card text-center text-white mt-4" style="width: 28%; height: 263px; background-color: rgba(0, 0, 0, 0.5); padding: 10px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); position: absolute; right: 0; top: 6%">
          <div class="card-body">
            <i class="bi bi-shield-lock-fill" style="font-size: 90px;"></i>
            <p class="mt-2" style="font-size: 12px; font-weight: 500;">
          Your audio files are processed locally. We prioritize your privacy and confidentiality by not storing or sharing your data.
            </p>
          </div>
        </div>
        <div class=" card p-5 mt-3" style="width: 60%; border-radius: 30px;background-color: #563a9c6e;box-shadow: rgba(0, 0, 0, 0.1) 0px 20px 25px -5px,rgba(0, 0, 0, 0.04) 0px 10px 10px -5px; margin-left: 10%;">
          <form id="uploadForm">
            <!-- Input Method Selection -->
            <div class="btn-group w-100 mb-3" role="group">
              <input type="radio" class="btn-check" name="inputMethod" id="fileInput" autocomplete="off" checked />
              <label class="btn btn-outline-primary mx-1 border-0" for="fileInput"
                style="font-weight: 500; background-color: #8b5dff">
                <i class="bi bi-file-earmark-music"></i> Upload File
              </label>

              <input type="radio" class="btn-check" name="inputMethod" id="micInput" autocomplete="off" />
              <label class="btn btn-outline-primary text-white border-0" for="micInput"
                style="font-weight: 500; background-color: #8b5dff">
                <i class="bi bi-mic"></i> Record Audio
              </label>
            </div>

            <!-- File Upload Section -->
            <div id="fileSection" class="input-method active">
              <div class="mb-3">
                <label for="audioFile" class="form-label text-white" style="font-weight: 600">Upload Audio File</label>
                <input type="file" class="form-control" id="audioFile" accept="audio/*" style="padding: 10px" />
              </div>
            </div>

            <!-- Microphone Recording Section -->
            <div id="micSection" class="input-method">
              <div class="text-center mb-3">
                <button type="button" id="recordButton" class="record-button"
                  style="box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1)">
                  <i class="bi bi-mic-fill"></i>
                </button>
                <p id="recordingStatus" class="mt-2 text-white" style="font-size: 14px; color: #6c757d">
                  Click to start recording
                </p>
              </div>
              <div id="audioVisualizer" class="audio-visualizer"
                style="background: linear-gradient(90deg, #007bff, #6610f2)"></div>
              <audio id="recordedAudio" controls style="display: none; width: 100%; border-radius: 5px"
                class="mb-3"></audio>
            </div>

            <div class="mb-3">
              <label for="targetLanguage" class="form-label text-white" style="font-weight: 600">Target Language</label>
              <select class="form-select" id="targetLanguage" required style="padding: 10px; border-radius: 5px">
                <option value="">Select language...</option>
                <option value="Afrikaans">Afrikaans</option>
                <option value="Arabic">Arabic</option>
                <option value="Albanian">Albanian</option>
                <option value="Amharic">Amharic</option>
                <option value="Armenian">Armenian</option>
                <option value="Azerbaijani">Azerbaijani</option>
                <option value="Bengali">Bengali</option>
                <option value="Bosnian">Bosnian</option>
                <option value="Bulgarian">Bulgarian</option>
                <option value="Burmese">Burmese</option>
                <option value="Catalan">Catalan</option>
                <option value="Chinese">Chinese (Mandarin)</option>
                <option value="Croatian">Croatian</option>
                <option value="Czech">Czech</option>
                <option value="Danish">Danish</option>
                <option value="Dutch">Dutch</option>
                <option value="English">English</option>
                <option value="Estonian">Estonian</option>
                <option value="Filipino">Filipino</option>
                <option value="Finnish">Finnish</option>
                <option value="French">French</option>
                <option value="Galician">Galician</option>
                <option value="Georgian">Georgian</option>
                <option value="German">German</option>
                <option value="Greek">Greek</option>
                <option value="Gujarati">Gujarati</option>
                <option value="Hebrew">Hebrew</option>
                <option value="Hindi">Hindi</option>
                <option value="Hungarian">Hungarian</option>
                <option value="Icelandic">Icelandic</option>
                <option value="Indonesian">Indonesian</option>
                <option value="Irish">Irish</option>
                <option value="Italian">Italian</option>
                <option value="Japanese">Japanese</option>
                <option value="Javanese">Javanese</option>
                <option value="Kannada">Kannada</option>
                <option value="Kazakh">Kazakh</option>
                <option value="Khmer">Khmer</option>
                <option value="Korean">Korean</option>
                <option value="Lao">Lao</option>
                <option value="Latvian">Latvian</option>
                <option value="Lithuanian">Lithuanian</option>
                <option value="Macedonian">Macedonian</option>
                <option value="Malay">Malay</option>
                <option value="Malayalam">Malayalam</option>
                <option value="Maltese">Maltese</option>
                <option value="Marathi">Marathi</option>
                <option value="Mongolian">Mongolian</option>
                <option value="Nepali">Nepali</option>
                <option value="Norwegian">Norwegian</option>
                <option value="Persian">Persian</option>
                <option value="Polish">Polish</option>
                <option value="Portuguese">Portuguese</option>
                <!-- <option value="Punjabi">Punjabi</option> -->
                <option value="Romanian">Romanian</option>
                <option value="Russian">Russian</option>
                <option value="Serbian">Serbian</option>
                <option value="Sinhala">Sinhala</option>
                <option value="Slovak">Slovak</option>
                <option value="Slovenian">Slovenian</option>
                <option value="Spanish">Spanish</option>
                <option value="Swahili">Swahili</option>
                <option value="Swedish">Swedish</option>
                <option value="Tamil">Tamil</option>
                <option value="Telugu">Telugu</option>
                <option value="Thai">Thai</option>
                <option value="Turkish">Turkish</option>
                <option value="Ukrainian">Ukrainian</option>
                <option value="Urdu">Urdu</option>
                <option value="Uzbek">Uzbek</option>
                <option value="Vietnamese">Vietnamese</option>
                <option value="Welsh">Welsh</option>
                <option value="Zulu">Zulu</option>
              </select>
            </div>

            <button type="submit" class="btn w-100 text-white ladda-button" data-style="expand-right" style="
                  padding: 12px;
                  font-size: 16px;
                  font-weight: 600;
                  background-color: #8b5dff;
                ">
              <span class="ladda-label">Process Audio</span>
            </button>
            <!-- <button type="submit" class="bubbly-button">Click me!</button> -->
          </form>
          
        </div>
        
        

        <div id="loadingIndicator" class="loading text-center mb-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Processing your audio...</p>
        </div>
        

        <div id="results" class="card p-5 mt-3" style="display: none; width: 60%; border-radius: 30px;background-color: #563a9c6e;box-shadow: rgba(0, 0, 0, 0.1) 0px 20px 25px -5px,rgba(0, 0, 0, 0.04) 0px 10px 10px -5px; margin-left: 10%;">
          <h3 class="mb-3">Results</h3>

          <div class="mb-4">
            <h5>Original Transcription:</h5>
            <p id="transcription" class="p-3 bg-light rounded"></p>
          </div>

          <div>
            <h5>Translated Audio:</h5>
            <audio id="audioPlayer" controls>
              Your browser does not support the audio element.
            </audio>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let mediaRecorder;
    let audioChunks = [];
    let isRecording = false;
    let recordedAudioBlob;

    function showError(message) {
      const errorAlert = document.getElementById("errorAlert");
      const errorMessage = document.getElementById("errorMessage");
      errorMessage.textContent = message;
      errorAlert.style.display = "block";
      setTimeout(() => {
        errorAlert.style.display = "none";
      }, 5000);
    }

    function showSuccess(message) {
      const successAlert = document.getElementById("successAlert");
      const successMessage = document.getElementById("successMessage");
      successMessage.textContent = message;
      successAlert.style.display = "block";
      setTimeout(() => {
        successAlert.style.display = "none";
      }, 5000);
    }

    // Input method switching
    document
      .querySelectorAll('input[name="inputMethod"]')
      .forEach((input) => {
        input.addEventListener("change", (e) => {
          document.querySelectorAll(".input-method").forEach((method) => {
            method.classList.remove("active");
          });
          if (e.target.id === "fileInput") {
            document.getElementById("fileSection").classList.add("active");
          } else {
            document.getElementById("micSection").classList.add("active");
          }
        });
      });

    // Microphone recording
    document
      .getElementById("recordButton")
      .addEventListener("click", async () => {
        if (!isRecording) {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({
              audio: true,
            });
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];

            mediaRecorder.ondataavailable = (event) => {
              audioChunks.push(event.data);
            };

            mediaRecorder.onstop = () => {
              recordedAudioBlob = new Blob(audioChunks, {
                type: "audio/wav",
              });
              const audioUrl = URL.createObjectURL(recordedAudioBlob);
              const recordedAudio = document.getElementById("recordedAudio");
              recordedAudio.src = audioUrl;
              recordedAudio.style.display = "block";
            };

            mediaRecorder.start();
            isRecording = true;
            document
              .getElementById("recordButton")
              .classList.add("recording");
            document.getElementById("recordingStatus").textContent =
              "Recording... Click to stop";
            document.getElementById("audioVisualizer").style.display =
              "block";
          } catch (err) {
            showError("Error accessing microphone: " + err.message);
          }
        } else {
          mediaRecorder.stop();
          mediaRecorder.stream.getTracks().forEach((track) => track.stop());
          isRecording = false;
          document
            .getElementById("recordButton")
            .classList.remove("recording");
          document.getElementById("recordingStatus").textContent =
            "Recording completed";
          document.getElementById("audioVisualizer").style.display = "none";
        }
      });

    document
      .getElementById("uploadForm")
      .addEventListener("submit", async (e) => {
        e.preventDefault();

        const targetLanguage =
          document.getElementById("targetLanguage").value;
        if (!targetLanguage) {
          showError("Please select a target language");
          return;
        }

        let audioFile;
        const inputMethod = document.querySelector(
          'input[name="inputMethod"]:checked'
        ).id;

        if (inputMethod === "fileInput") {
          audioFile = document.getElementById("audioFile").files[0];
          if (!audioFile) {
            showError("Please select an audio file");
            return;
          }
        } else {
          if (!recordedAudioBlob) {
            showError("Please record some audio first");
            return;
          }
          audioFile = new File([recordedAudioBlob], "recorded_audio.wav", {
            type: "audio/wav",
          });
        }

        // Show loading indicator
        document.getElementById("loadingIndicator").style.display = "block";
        document.getElementById("results").style.display = "none";
        document.getElementById("errorAlert").style.display = "none";
        document.getElementById("successAlert").style.display = "none";

        try {
          console.log("Starting transcription...");
          // First, transcribe the audio
          const formData = new FormData();
          formData.append("file", audioFile);

          const transcriptionResponse = await fetch("/transcribe", {
            method: "POST",
            body: formData,
          });

          if (!transcriptionResponse.ok) {
            const error = await transcriptionResponse.text();
            throw new Error(`Transcription failed: ${error}`);
          }

          const transcriptionText = await transcriptionResponse.text();
          console.log("Transcription completed:", transcriptionText);
          showSuccess("Audio transcribed successfully!");

          // Then, translate and get TTS
          console.log("Starting translation and TTS...");
          const translateFormData = new FormData();
          translateFormData.append("text", transcriptionText);
          translateFormData.append("target_language", targetLanguage);

          const ttsResponse = await fetch("/translate-tts", {
            method: "POST",
            body: translateFormData,
          });

          if (!ttsResponse.ok) {
            const error = await ttsResponse.text();
            throw new Error(`Translation/TTS failed: ${error}`);
          }

          // Create blob URL for audio player
          const audioBlob = await ttsResponse.blob();
          const audioUrl = URL.createObjectURL(audioBlob);

          // Update UI with results
          document.getElementById("transcription").textContent =
            transcriptionText;
          document.getElementById("audioPlayer").src = audioUrl;
          document.getElementById("results").style.display = "block";
          showSuccess(
            "Translation and text-to-speech completed successfully!"
          );
        } catch (error) {
          console.error("Error:", error);
          showError(error.message);
        } finally {
          document.getElementById("loadingIndicator").style.display = "none";
        }
      });

    // Bubbly Button Animation
    //   var animateButton = function (e) {
    //     e.preventDefault;
    //     //reset animation
    //     e.target.classList.remove("animate");

    //     e.target.classList.add("animate");
    //     setTimeout(function () {
    //       e.target.classList.remove("animate");
    //     }, 700);
    //   };

    //   var bubblyButtons = document.getElementsByClassName("bubbly-button");

    //   for (var i = 0; i < bubblyButtons.length; i++) {
    //     bubblyButtons[i].addEventListener("click", animateButton, false);
    //   }
    // Automatically bind Ladda buttons
    Ladda.bind("button[type=submit]");

    // OR manually control it
    const btn = document.querySelector(".ladda-button");
    const ladda = Ladda.create(btn);

    // Example: start on form submit
    document.querySelector("form").addEventListener("submit", function (e) {
      e.preventDefault(); // remove this if you want the form to submit
      ladda.start();

      // Simulate a process (like an AJAX call)
      setTimeout(() => {
        ladda.stop();
        // Optionally reset the form or do other things
      }, 3000);
    });
  </script>
</body>

</html>